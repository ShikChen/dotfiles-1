# vim: set ft=sh:

fresh freshshell/fresh bin/fresh --bin
fresh freshshell/fresh contrib/source-build.sh --file=~/.zshrc

fresh sorin-ionescu/prezto . --file=~/.zprezto/
fresh zsh/\* --file=~/.zshrc

fresh config/\* --file
fresh bin/\* --bin

fresh_after_build() {
  # Workaround for git submodule: https://github.com/freshshell/fresh/issues/95
  if [ -z "${updated_submodules+1}" ]; then
    cd $FRESH_PATH/source/sorin-ionescu/prezto/ \
      && git pull && git submodule update --init --recursive
    export updated_submodules=0
  fi
  if [ "$updated_submodules" -eq 0 ]; then
    export updated_submodules=$[updated_submodules+1]
    ~/bin/fresh
  fi
  unset updated_submodules

  if [[ ! -f $FRESH_LOCAL/.setup ]]; then
    echo -e '\e[1;33mFirst time setup! Make sure we have everything installed...\e[m'
    pushd $FRESH_LOCAL
      ./setup/main.sh
    popd
    if [[ $? == 0 ]]; then
      touch $FRESH_LOCAL/.setup
      echo -e '\e[1;33mFirst time setup complete! Delete $FRESH_LOCAL/.setup and fresh to run again.\e[m'
    else
      echo -e '\e[1;31mFirst time setup fail QQ\e[m'
      exit 1
    fi
  fi
}
